<!--customer adds info to get on waitlist-->
<DOCTYPE html/>
<html>

<head> 
    <link rel="stylesheet" href="{{ url_for('static',filename='styles/custInfo.css') }}">

      <!-- JQuery-->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      
    <title>Customer Check In</title>
    <meta charset="UTF-8">
</head>
<body>

<h1> Welcome Customer! </h1>
<h2>Please fill in your information below to be added to the list!</h2>

<div class="topLeftCircle"></div>
<img src="{{ url_for('static',filename='images/RobotLaptop.png') }}">
<div class="topRightCircle"></div>
<div class="bottomRightCircle"></div>


<div class="info">
    <form action="" method="POST" id="waitListForm">
      
      <label class ="" for="name">Name:</label>
      <input type="text" name="name" value="" id="name" placeholder= "Your Name... " required />

      <label class ="" for="emailAddr">Email Address:</label>
      <input type="text" name="emailAddr" value="" id="emailAddr" placeholder= "Your email address" required />


      <label class="" for="partySize">Party size:</label>
      <select id="partySize" name="partySize">

        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>

      </select>
    
      <button id="submit_button" type="button">Submit</button>
    </form>
  </div>
  
</body>

<script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.2.4/firebase-firestore.js"></script>
<script type="text/javascript">

function getCookie(cname) 
{

  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');

  for(let i = 0; i < ca.length; i++)
  {

    let c = ca[i];

    while (c.charAt(0) == ' ') 
    {

        c = c.substring(1);

    }

    if (c.indexOf(name) == 0) 
    {

      return c.substring(name.length, c.length);

    }
  }

  return "";

}

function deleteCookie(cname) 
{

  document.cookie = cname + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";

}

// https://www.w3schools.com/js/js_cookies.asp
function setCookie(cname, cvalue, exdays) 
{

  const d = new Date();
  d.setTime(d.getTime() + (exdays*24*60*60*1000));
  let expires = "expires="+ d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";

}

$(document).ready(() => {

  if(getCookie("confirmed") != "")
  {

    deleteCookie("confirmed");

  }

  if(getCookie("custEmail") != "")
  {

    deleteCookie("custEmail");

  }        
});

(function() {

  const firebaseConfig = {
    apiKey: "AIzaSyCO1jpQFRfTuvF6HhFJ6_h5Jidnf2FioE4",
    authDomain: "robohost-demo.firebaseapp.com",
    projectId: "robohost-demo",
    storageBucket: "robohost-demo.appspot.com",
    messagingSenderId: "726676323212",
    appId: "1:726676323212:web:40658cad3d927d08f774a9",
    measurementId: "G-0ZC1969JGH"
  };

  firebase.initializeApp(firebaseConfig);

  var push_to_firebase = function(data){
        var db = firebase.firestore();
        var enteredName = data["name"]
        var enteredEmail = data["email"];

        db.collection("custInfo").add({
          name: data["name"],
          email: data["email"],
          partySize: data["partySize"]
        })

        .then(function(docRef) {
            console.log("Message sent, ID: ", docRef.id);
            setCookie("confirmed", 1, 1);
            setCookie("custEmail", enteredEmail, 1);
            location.href = '/custConfirm';
            
        })
        .catch(function(error) {
            console.error("Message could not be sent: ", error);
        });
      }

      var contact_submit = function(){
        var name = document.getElementById("name");
        var email = document.getElementById("emailAddr");
        var partySize = document.getElementById("partySize");

        var data = {
          "name": name.value,
          "email": email.value,
          "partySize": partySize.value
        }

        if(name.value.length > 0 && email.value.length > 0)
        {

            var checkIfValidEmail = (email) => {

              return String(email)
              .toLowerCase()
              .match(
                /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
              );
            };

            if(!checkIfValidEmail(email.value))
            {

              alert("Please enter a valid email address!");

            }
            else
            {

              push_to_firebase(data);
            
            }

        }
        else
        {

          alert("Please fill out all available fields!");

        }
      }

      document.getElementById("submit_button").addEventListener("click", contact_submit);
    })();
  </script>
</html>